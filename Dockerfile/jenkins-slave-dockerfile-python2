FROM jenkins/jnlp-slave

USER root

ENV PYTHON_VERSION 2.7

RUN apt-get update \
    && apt-get dist-upgrade -y \
    && apt-get -y install python${PYTHON_VERSION} \
       libffi-dev \
       libpq-dev \
       libssl-dev \
       libatlas-base-dev gfortran \
       python-dev \
       python-scipy \
       ipython \
       libmariadbclient-dev \
       python-pip \
       python-setuptools \
       python-virtualenv \
       virtualenvwrapper \
       python-wheel \
       build-essential \
    && rm -rf /var/lib/apt/lists/* \
    && ln -nsf /usr/bin/python2.7 /usr/bin/python
	

#install dependancy
RUN pip install chardet==3.0.2 idna==2.5 pyasn1==0.4.1
RUN pip install setuptools --upgrade
RUN pip install git+ssh://git@bitbucket.org/percolata/database-access.git#egg=database_access
RUN pip install git+ssh://git@bitbucket.org/percolata/backend-common.git@master#egg=backend_common
	
RUN pip install coverage 
RUN pip install requests --upgrade
RUN pip install pyasn1-modules --upgrade
RUN pip install pandas-gbq google-cloud-storage google-cloud-bigquery google-api-python-client

# install package for weather
RUN apt-get update && apt-get install -y --no-install-recommends \
    apt-utils \
    wget \
    bison \
    flex \
    autoconf \
    libtool \
    zlib1g-dev \
    texinfo \
    help2man \
    gawk \
    g++ \
    curl \
    texlive \
    cmake \
    subversion \
    && apt-get clean && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

# pip install python packages
RUN pip install jupyter sympy nose mysql-connector-python

RUN pip install passlib redis arrow
RUN pip install numpy==1.16.2 configparser
RUN pip install cvxpy==0.4.2
RUN pip install MySQL-python
RUN pip install pandas requests
RUN pip install redis slackclient
RUN pip install graypy[amqp]==0.3.1
RUN pip install pymysql gsutil
RUN pip install azure.storage==0.20.0
RUN pip install azure-datalake-store
RUN pip install azure-mgmt-resource
RUN pip install azure-mgmt-datalake-store
RUN pip install scikit-learn==0.18.1 \
                tensorflow==1.2.1 \
                tqdm==4.15.0 \
                statsmodels==0.8.0 \
                future==0.16.0 \
                six==1.10.0 \
                bokeh==0.12.6 \
                pytest==3.2.2 \
                keras==1.0.5 \
                pymongo==3.4.0 \
                tsfresh==0.11.0 \
                xgboost==0.71 \
                gitpython==2.1.10 \
                matplotlib==2.1.2 \
                pathlib


#ENV ENV $HOME/venv/bin/activate
#ENV BASH_ENV $HOME/venv/bin/activate

RUN chown -R jenkins:jenkins $HOME && \
    chmod -R g+rw $HOME

#ENTRYPOINT ["/bin/sh"]
