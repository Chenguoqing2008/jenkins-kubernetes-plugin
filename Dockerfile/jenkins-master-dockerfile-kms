FROM jenkins/jenkins:lts

MAINTAINER robin.chen@percolata.com

USER root

ENV PYTHON_VERSION 3.4

# add and install all the necessary dependencies
RUN apt-get update -y && \
	apt-get upgrade -y

RUN apt-get install -y \
	python${PYTHON_VERSION} \
	libffi-dev \
        libpq-dev \
        libssl-dev \
        python3-dev \
        python3-pip \
        python3-setuptools \
        python3-venv \
        python3-wheel \
        build-essential \
  	git \
  	curl \
  	vim \
  	ssh \
  	gcc \
  	zip \
	wget \
  	unzip && \
	rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* && \
	ln -nsf /usr/bin/python3.4 /usr/bin/python

# add bitbuckets key
ADD id_rsa-bitbucket-backend /root/.ssh/id_rsa
RUN chmod 600 /root/.ssh/id_rsa

# Create known_hosts
RUN touch /root/.ssh/known_hosts

# Add bitbuckets key
RUN ssh-keyscan bitbucket.org >> /root/.ssh/known_hosts
RUN pip3 install git+ssh://git@bitbucket.org/percolata/backend-common.git@master#egg=backend_common

# install coverage
RUN pip3 install coverage google-api-python-client google-cloud-kms==0.2.1 \
        google-auth google-auth-httplib2 pycrypto pyasn1  pyasn1-modules

VOLUME /var/jenkins_home/


